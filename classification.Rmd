---
title: "classification"
author: "Timothy Roy"
date: '2023-04-17'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#Libraries
library(skimr)
library(dplyr)
library(utils)
library(caret)
library(ggplot2)
library(caret)
library(lattice)
library(Matrix)
library(tidyr)
```

# Task 1.1 Data cleaning 

## The first problem with the data is that the columns are not seperated 
```{r }
contract <- read.csv("labor-negotiations_students.csv")

head(contract)
```
## By using ';' seperator, the values can be organized into different columns

```{r}
contract <- read.csv("labor-negotiations_students.csv",  sep = ";")

str(contract)
```
```{r}
contract_backup<- read.csv("labor-negotiations_students.csv",  sep = ";")
str(contract_backup)
```

## Data Quality Issues
* Not removing rows if a columns have NA values since we have a small data set
* When using columns with NA values, all the NA values would be ignored
* Wage1 has negative values (2.0-7.0)
* Wage2 has value bigger than 7.0
* Wage3 has negative value
* Hours shouldn't be more than 40
* Stable pay consists of negative values
* Holidays should not contain more than 15 days


```{r}
contract %>% skim()
```


## Checking for unique values to find anomalies

```{r}
num_of_cols <- ncol(contract)
print(paste("The number of columns in the df is ",num_of_cols ))


```

## Possible problem with 501?
* 501 stands out here because. It has probably replaced 16 here
* And 501 is missing after 500. 
*Therefore, I will use my intuition and replace them 
```{r}
unique(contract$profession)
```
## Possible fix?

```{r}
contract$profession <- seq(1,600, by = 1)

head(contract$profession, 20)
contract[500:520,]$profession
```


```{r}
unique(contract$duration)
```

## Problem: Negative Values
* The description page shows that this columns can not contain negative values. Therefore all the negative values would be replaced by NA

```{r}
unique(contract$wage1)
```
* Replacing negative values and values smaller than 2 or bigger than 7 with NA
```{r}
contract$wage1 <- replace(contract$wage1, contract$wage1 < 0, NA)
contract$wage1 <- replace(contract$wage1, contract$wage1 < 2, NA)
contract$wage1 <- replace(contract$wage1, contract$wage1 > 7, NA)
contract$wage1
```

```{r}
unique(contract$wage2)
```

* Replacing negative values and values smaller than 2 or bigger than 7 with NA

```{r}
contract$wage2 <- replace(contract$wage2, contract$wage2 < 0, NA)
contract$wage2 <- replace(contract$wage2, contract$wage2 < 2, NA)
contract$wage2 <- replace(contract$wage2, contract$wage2 > 7, NA)
unique(contract$wage2)
```

```{r}
unique(contract$wage3)
```

* Replacing negative values and values smaller than 2 or bigger than 7 with NA

```{r}
contract$wage3 <- replace(contract$wage3, contract$wage3 < 0, NA)
contract$wage3 <- replace(contract$wage3, contract$wage3 < 2, NA)
contract$wage3 <- replace(contract$wage3, contract$wage3 > 7, NA)
unique(contract$wage3)
```

## Problem: Empty Values
```{r}
unique(contract$cola)
```

* Replacing all empty values with NA
```{r}
contract$cola <- na_if(contract$cola, "")
unique(contract$cola)
```

## Problem: hours more than 40 hours should not be here
```{r}
unique(contract$hours)
```

* Replacing values more than 40 and less than 30 with NA

```{r}
contract$hours <- replace(contract$hours, contract$hours > 40, NA)
contract$hours <- replace(contract$hours, contract$hours < 35, NA)

unique(contract$hours)
```

## Problem: "self payed" doesn't exist in the definition 

```{r}
unique(contract$pension)
```

* Replacing them with NA and 'none'

```{r}
contract$pension <- na_if(contract$pension, "")
contract$pension <- replace(contract$pension, contract$pension == "self payed", "none")
unique(contract$pension)
```

## Problem: Negative Values!

```{r}
unique(contract$stby_pay)
```

```{r}
contract$stby_pay <- replace(contract$stby_pay, contract$stby_pay < 2, NA)
contract$stby_pay <- replace(contract$stby_pay, contract$stby_pay > 25, NA)
contract$stby_pay <- replace(contract$stby_pay, contract$stby_pay < 0, NA)

unique(contract$stby_pay)
```

## Problem: 0 values need to be repalced!
```{r}
unique(contract$shift_diff)
```


```{r}
contract$shift_diff <- replace(contract$shift_diff, contract$shift_diff == 0, NA)
unique(contract$shift_diff)
```

## Problem: no maybe, replace empty values
```{r}
unique(contract$educ_allow)
```

```{r}
contract$educ_allow <- replace(contract$educ_allow, contract$educ_allow == "maybe", NA)
contract$educ_allow <- na_if(contract$educ_allow, "")
unique(contract$educ_allow)
```

## Problem : out of bounds range
```{r}
unique(contract$holidays)
```

```{r}
contract$holidays <- replace(contract$holidays, contract$holidays < 9, NA)
contract$holidays <- replace(contract$holidays, contract$holidays > 15, NA)
unique(contract$holidays)
```

## Problems: values are not in the correct forms
```{r}
unique(contract$vacation)
```

```{r}
contract$vacation <- replace(contract$vacation, contract$vacation == "below average", "ba")
contract$vacation <- replace(contract$vacation, contract$vacation == "average", "avg")
contract$vacation <- replace(contract$vacation, contract$vacation == "average", "gnr")
contract$vacation <- na_if(contract$vacation, "")
unique(contract$vacation)
```


```{r}
unique(contract$lngtrm_disabil)
```

```{r}
contract$lngtrm_disabil <- na_if(contract$lngtrm_disabil, "")
unique(contract$lngtrm_disabil)
```

```{r}
unique(contract$dntl_ins)
```

```{r}
contract$dntl_ins <- na_if(contract$dntl_ins, "")
unique(contract$dntl_ins)
```

```{r}
unique(contract$breavement)
```

```{r}
contract$breavement <- na_if(contract$breavement, "")
contract$breavement <- replace(contract$breavement, contract$breavement == "maybe", NA)
unique(contract$breavement)
```

```{r}
unique(contract$Empl.hplan)
```

```{r}
contract$Empl.hplan <- na_if(contract$Empl.hplan, "")
contract$Empl.hplan <- replace(contract$Empl.hplan, contract$Empl.hplan == ".5", "half")
contract$Empl.hplan <- replace(contract$Empl.hplan, contract$Empl.hplan == "none", NA)
unique(contract$Empl.hplan)
```

```{r}
contract$Empl.hplan <- contract_backup$Empl.hplan
unique(contract$Empl.hplan)
```

```{r}
contract$Empl.hplan <- na_if(contract$Empl.hplan, "")
contract$Empl.hplan <- replace(contract$Empl.hplan, contract$Empl.hplan == ".5", "half")

unique(contract$Empl.hplan)
```

```{r}
unique(contract$consent)
```

```{r}
contract$consent <- replace(contract$consent, contract$consent == "??", NA)

unique(contract$consent)
```

## Look at the data one more time :)

* All the out of ranges values have been removed
* Standard deviation has decreased for hours, stable, pay and more!

```{r}
contract %>% skim()
```
```{r}
# Remove the rows with missing values
contract
```
```{r}
str(contract)
```


```{r}
contract$consent <- as.character(contract$consent)
contract %>% drop_na(consent)
str(contract$consent)
```


# Task 1.2 Classification


```{r}
# Convert the customer ID and contract status to factors

#contract$profession <- as.factor(contract$profession )
#$consent <- as.factor(contract$consent)
# Split the data into training and testing sets
set.seed(123)
train_index <- sample(nrow(contract), 0.8 * nrow(contract))
train_data <- contract[train_index, ]

test_data <- contract[-train_index, ]

#contract[train_index, ]
#contract[-train_index, ]




```

```{r}
sapply(lapply(contract, unique), length)
```


```{r}
# Build a logistic regression model to predict the contract status
model <- glm(consent ~ ., data = train_data, family = "binomial")
```

```{r}

 
# Make predictions on the test data
predictions <- predict(model, newdata = test_data, type = "response")
predictions <- ifelse(predictions > 0.5, "good", "bad")
 
# Evaluate the model performance
confusionMatrix(predictions, test_data$consent)
```















